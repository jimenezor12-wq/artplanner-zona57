<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtPlanner - Modo Aventura</title>
<link rel="manifest" href="manifest.json">
    <style>
        :root {
            --primary: #FF3366;
            --secondary: #20E3B2;
            --dark: #2B2D42;
            --light: #F8F9FA;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(-45deg, #23a6d5, #23d5ab, #ee7752, #e73c7e);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--dark);
            position: relative;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 650px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            z-index: 10;
        }
        
        .container::-webkit-scrollbar { display: none; }

        h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
            background: -webkit-linear-gradient(var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p.subtitle {
            font-size: 1.2em;
            color: var(--dark);
            font-weight: bold;
            margin-bottom: 25px;
            border-bottom: 2px dashed #ccc;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
            background-color: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .form-control:disabled {
            background-color: #eee;
            cursor: not-allowed;
            color: #666;
        }

        .pda-box {
            background-color: #f0f8ff;
            border: 2px solid #a4c8e1;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.95em;
            color: var(--dark);
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 90px;
        }

        .btn-submit {
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn-back {
            background: transparent;
            border: 2px solid var(--dark);
            color: var(--dark);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 15px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-back:hover {
            background: var(--dark);
            color: white;
        }

        .legacy-footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9em;
            font-weight: 500;
            letter-spacing: 1px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            z-index: 5;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ART PLANNER</h1>
        <p class="subtitle">üöÄ Modo Aventura: Exploraci√≥n libre del Programa Sint√©tico</p>

        <div class="form-group">
            <label for="grado-select">1. Selecciona el Grado (Fase 6):</label>
            <select id="grado-select" class="form-control" onchange="actualizarInterfaz()">
                <option value="" disabled selected>Elige un grado...</option>
                <option value="1">1er A√±o de Secundaria</option>
                <option value="2">2do A√±o de Secundaria</option>
                <option value="3">3er A√±o de Secundaria</option>
            </select>
        </div>

        <div class="form-group">
            <label for="contenido-select">2. Selecciona el Contenido del programa:</label>
            <select id="contenido-select" class="form-control" disabled onchange="mostrarPDA()">
                <option value="" disabled selected>Primero selecciona un grado...</option>
            </select>
        </div>

        <div class="form-group">
            <label>3. Tu PDA correspondiente es:</label>
            <div id="pda-display" class="pda-box">
                <em>Selecciona el grado y contenido para ver el PDA a explorar.</em>
            </div>
        </div>

        <div class="form-group">
            <label for="problematica-input">4. Problem√°tica del contexto (escuela o comunidad):</label>
            <textarea id="problematica-input" class="form-control" placeholder="Describe brevemente la situaci√≥n a atender..."></textarea>
        </div>

        <button class="btn-submit" onclick="generarPlaneacion()">‚ú® Generar Planeaci√≥n de Aventura ‚ú®</button>
        
        <div id="caja-resultado" class="hidden" style="margin-top: 30px; text-align: left; background: white; padding: 25px; border-radius: 15px; border: 2px solid var(--secondary); box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
            <h3 style="color: var(--dark); margin-top: 0; border-bottom: 2px solid var(--primary); padding-bottom: 10px;">Tu Planeaci√≥n Interdisciplinaria:</h3>
            <div id="texto-ia" style="font-size: 1.05em; line-height: 1.6; color: #333; white-space: pre-wrap;"></div>
        </div>
        
        <br>
        <button class="btn-back" onclick="window.location.href='index.html'">Volver al Inicio</button>
    </div>

    <div class="legacy-footer">
        APP creada por el ATP Ulises Jimenez
    </div>

    <script>
        // Recuperamos la especialidad solo para tenerla en la memoria, pero NO la mostramos como limitante
        let especialidad = localStorage.getItem('especialidad_docente') || "No especificada";

        // ==========================================
        // BASE DE DATOS DE ARTES (CONTENIDOS Y PDAS)
        // ==========================================
        const baseDatosArtes = [
            {
                contenido: "Diversidad de lenguajes art√≠sticos en la riqueza pluricultural de M√©xico y del mundo.",
                pdas: {
                    "1": "Reconoce en manifestaciones art√≠sticas de M√©xico y del mundo el uso del cuerpo, del espacio y del tiempo, para valorarlas como parte de la riqueza pluricultural.",
                    "2": "Explora la creaci√≥n de secuencias y patrones al identificar el uso de formas, colores, movimientos, sonidos, entre otros elementos de las artes, en manifestaciones art√≠sticas de M√©xico y del mundo, para apreciar la riqueza pluricultural.",
                    "3": "Experimenta con caracter√≠sticas de algunos estilos de los lenguajes art√≠sticos, para representar la riqueza pluricultural de M√©xico y del mundo."
                }
            },
            {
                contenido: "Manifestaciones culturales y art√≠sticas que conforman la diversidad √©tnica, cultural y ling√º√≠stica.",
                pdas: {
                    "1": "Identifica diferentes manifestaciones culturales y art√≠sticas de pueblos ind√≠genas y afrodescendientes de M√©xico y del mundo, para interpretar significados que permitan fomentar una sociedad intercultural.",
                    "2": "Compara el uso de formas, colores, movimientos, sonidos, entre otros elementos de las artes, en manifestaciones culturales y art√≠sticas de diferentes √©pocas y or√≠genes culturales, para fomentar una sociedad intercultural.",
                    "3": "Presenta una propuesta creativa, usando intencionalmente el cuerpo, espacio y tiempo, entre otros elementos de las artes, para valorar y promover la diversidad √©tnica, cultural y ling√º√≠stica, a favor de una sociedad intercultural."
                }
            },
            {
                contenido: "Identidad y sentido de pertenencia en manifestaciones art√≠sticas.",
                pdas: {
                    "1": "Aprecia la intenci√≥n expresiva en diversas manifestaciones art√≠sticas, para la construcci√≥n cr√≠tica de las identidades personal y colectiva.",
                    "2": "Reflexiona sobre la manera en que las artes fortalecen la identidad, dan sentido de pertenencia y resultan esenciales para favorecer la interculturalidad cr√≠tica.",
                    "3": "Crea propuestas art√≠sticas utilizando intencionalmente caracter√≠sticas de algunos estilos art√≠sticos, a favor de la interculturalidad cr√≠tica, para fortalecer las identidades personal y colectiva."
                }
            },
            {
                contenido: "Patrimonio cultural de la comunidad en manifestaciones art√≠sticas que fomentan la identidad y el sentido de pertenencia.",
                pdas: {
                    "1": "Interpreta manifestaciones art√≠sticas del patrimonio cultural de la comunidad y de M√©xico, para fomentar las identidades personal y colectiva, as√≠ como el sentido de pertenencia.",
                    "2": "Expresa, mediante lenguajes art√≠sticos, la relevancia de valorar, conservar y preservar el patrimonio cultural, como legado que le otorga identidad y sentido de pertenencia.",
                    "3": "Reinterpreta de manera respetuosa manifestaciones art√≠sticas del patrimonio cultural, para valorar su identidad y sentido de pertenencia."
                }
            },
            {
                contenido: "Los lenguajes art√≠sticos en la expresi√≥n de problemas de la comunidad.",
                pdas: {
                    "1": "Usa intencionalmente formas, colores, movimientos, sonidos, entre otros elementos de las artes, para recrear una situaci√≥n problem√°tica de su contexto y manifestar una postura cr√≠tica.",
                    "2": "Investiga propuestas art√≠sticas colectivas de entornos rurales y urbanos a favor de la inclusi√≥n, para presentar una postura cr√≠tica sobre un problema de la comunidad.",
                    "3": "Experimenta con t√©cnicas art√≠sticas y elige una que implemente en un proyecto escolar creativo, para imaginar y proponer posibles soluciones a problemas de la comunidad."
                }
            },
            {
                contenido: "Elementos de las artes y recursos est√©ticos apreciados en el entorno natural y social, as√≠ como en diversas manifestaciones art√≠sticas.",
                pdas: {
                    "1": "(1) Identifica el uso intencional del cuerpo, del espacio y del tiempo en manifestaciones art√≠sticas, para apreciar e interpretar sus sentidos y significados. (2) Percibe cualidades est√©ticas en el entorno natural y social, para interpretar sus sentidos y significados.",
                    "2": "(1) Analiza el uso intencional de elementos de las artes y recursos est√©ticos como ritmo, repetici√≥n, armon√≠a, contraste, variaci√≥n, en manifestaciones art√≠sticas, para emplearlos en una creaci√≥n personal. (2) Reinterpreta los sentidos y significados de las cualidades est√©ticas del entorno natural y social en creaciones art√≠sticas personales.",
                    "3": "(1) Usa intencionalmente figuras ret√≥ricas como met√°foras, hip√©rboles, sin√©cdoques, aliteraciones, en creaciones art√≠sticas colectivas, para representar situaciones vinculadas a la comunidad. (2) Interviene el entorno natural y social, mediante el uso de los lenguajes art√≠sticos, para expresar un mensaje a favor del cuidado del medioambiente."
                }
            },
            {
                contenido: "Valor est√©tico de la naturaleza, de la vida cotidiana y de diferentes manifestaciones culturales y art√≠sticas.",
                pdas: {
                    "1": "(1) Disfruta de manifestaciones culturales y art√≠sticas de la comunidad y de otros lugares, para reconocer sus gustos e intereses est√©ticos. (2) Disfruta los valores est√©ticos presentes en la naturaleza, para apreciarla y expresarla.",
                    "2": "(1) Investiga diversas manifestaciones culturales y art√≠sticas, para expresar un juicio est√©tico y lo difunde en la comunidad escolar. (2) Emite un juicio est√©tico sobre un episodio significativo de la vida cotidiana y lo difunde en la comunidad escolar.",
                    "3": "(1) Identifica algunas categor√≠as est√©ticas como lo bello, lo sublime, lo grotesco, lo tr√°gico, lo c√≥mico, lo siniestro, al apreciarlas en manifestaciones culturales y art√≠sticas, para argumentar sus juicios est√©ticos y difundirlos en la comunidad. (2) Identifica algunas categor√≠as est√©ticas como lo bello, lo sublime, lo grotesco, lo tr√°gico, lo c√≥mico, lo siniestro, al apreciarlas en la naturaleza y en la vida cotidiana, para compartir sus juicios est√©ticos y difundirlos en la comunidad."
                }
            },
            {
                contenido: "Creaciones art√≠sticas que tienen su origen en textos literarios.",
                pdas: {
                    "1": "Explora con formas, colores, movimientos, sonidos, entre otros elementos de las artes, para reinterpretar textos literarios de la comunidad u otros lugares, haciendo uso de diversos lenguajes art√≠sticos.",
                    "2": "Adapta textos literarios provenientes de culturas ind√≠genas o afrodescendientes, experimentando con elementos de las artes y recursos est√©ticos como la repetici√≥n, ritmo, armon√≠a, contraste, variaci√≥n, para sensibilizar a la comunidad sobre las formas de expresi√≥n de los pueblos originarios.",
                    "3": "Construye una narrativa personal o colectiva, a partir de un texto literario de su inter√©s, empleando en forma art√≠stica cuerpo, espacio y tiempo."
                }
            },
            {
                contenido: "Expresi√≥n art√≠stica de sensaciones, emociones, sentimientos e ideas, a partir de experiencias familiares, escolares o comunitarias.",
                pdas: {
                    "1": "Recrea l√∫dicamente sensaciones, emociones, sentimientos e ideas, mediante el uso del cuerpo, del espacio y del tiempo, para expresar la relaci√≥n con su entorno familiar.",
                    "2": "Explora con t√©cnicas art√≠sticas y elige una para apreciar, simbolizar y compartir sensaciones, emociones, sentimientos e ideas relacionados con el entorno escolar.",
                    "3": "Usa intencionalmente caracter√≠sticas y funciones de algunos g√©neros art√≠sticos, para crear una obra original que simbolice sus v√≠nculos con la comunidad."
                }
            },
            {
                contenido: "Memoria colectiva representada por medios art√≠sticos, para registrar experiencias comunitarias.",
                pdas: {
                    "1": "Recupera de la memoria colectiva acontecimientos significativos de las familias, escuela o comunidad, para representarlos de manera creativa.",
                    "2": "Reinterpreta, mediante caracter√≠sticas de algunos g√©neros art√≠sticos, un acontecimiento familiar, escolar o comunitario significativo de la memoria colectiva.",
                    "3": "Manifiesta una postura cr√≠tica sobre la memoria colectiva, acerca de un acontecimiento relevante para la comunidad, al hacer uso de los lenguajes art√≠sticos."
                }
            },
            {
                contenido: "Procesos creativos que ponen en pr√°ctica la comunicaci√≥n dial√≥gica, como estrategia para erradicar expresiones de violencia.",
                pdas: {
                    "1": "Expresa, mediante elementos de las artes como las formas, colores, movimientos, sonidos, la relevancia del di√°logo como una alternativa a las manifestaciones de violencia presentes en la familia, escuela y comunidad.",
                    "2": "Imagina y comparte propuestas art√≠sticas de acci√≥n para contribuir en la erradicaci√≥n de la violencia en la familia, escuela y comunidad, haciendo uso de una comunicaci√≥n abierta, respetuosa y emp√°tica con la diversidad.",
                    "3": "Presenta al p√∫blico una propuesta art√≠stica respetuosa y emp√°tica con la diversidad, para sensibilizar a la comunidad acerca de la importancia del di√°logo para erradicar la violencia en el entorno."
                }
            },
            {
                contenido: "Vida saludable expresada a trav√©s de mensajes construidos con elementos de las artes, para difundirlos por distintos medios de comunicaci√≥n.",
                pdas: {
                    "1": "Emplea intencionalmente formas, colores, movimientos, sonidos, entre otros elementos de las artes, para representar una vida saludable y la difunde por un medio de comunicaci√≥n escolar.",
                    "2": "Crea mensajes que promuevan una vida saludable, utilizando art√≠sticamente formas, colores, movimientos y sonidos, entre otros elementos de las artes, para difundirlos por distintos medios de comunicaci√≥n.",
                    "3": "Construye una narrativa a favor de una vida saludable, mediante el uso art√≠stico de distintos formatos como fotograf√≠a, historieta, secuencia corporal, secuencia sonora, entre otros, y la difunde por distintos medios de comunicaci√≥n."
                }
            },
            {
                contenido: "Sistemas alternativos y aumentativos de comunicaci√≥n, como herramientas creativas que favorecen la inclusi√≥n.",
                pdas: {
                    "1": "Identifica algunas caracter√≠sticas sensoriales de la Lengua de Se√±as Mexicana, el c√≥digo Braille, los tableros de comunicaci√≥n y otros sistemas alternativos y aumentativos, para fomentar la interacci√≥n, sensibilizaci√≥n y empat√≠a con la diversidad.",
                    "2": "Experimenta con sistemas alternativos y aumentativos de comunicaci√≥n al usar art√≠sticamente el cuerpo, espacio, tiempo, entre otros elementos de las artes, en una propuesta comunitaria que visibilice la diversidad y fomente la inclusi√≥n social.",
                    "3": "Crea c√≥digos que favorezcan la inclusi√≥n, a trav√©s del uso art√≠stico de formas, colores, texturas, movimientos, gestos, sonidos, entre otros recursos que incorporen caracter√≠sticas de los sistemas alternativos y aumentativos."
                }
            },
            {
                contenido: "Manifestaciones art√≠sticas que emplean sistemas alternativos y aumentativos de comunicaci√≥n, elaboradas por personas en condici√≥n de discapacidad y/o dise√±adas para ellas.",
                pdas: {
                    "1": "Reconoce los valores est√©ticos y creativos de las manifestaciones art√≠sticas realizadas por personas con alguna discapacidad, para fomentar la inclusi√≥n.",
                    "2": "Aprecia y reflexiona acerca del uso de sistemas alternativos y aumentativos en manifestaciones art√≠sticas dise√±adas para personas en condici√≥n de discapacidad, a fin de favorecer el tr√°nsito a una sociedad incluyente.",
                    "3": "Presenta una creaci√≥n art√≠stica en la que experimente con sistemas alternativos y aumentativos de comunicaci√≥n, para favorecer el tr√°nsito a una sociedad incluyente."
                }
            }
        ];
        // ==========================================

        function actualizarInterfaz() {
            let gradoElegido = document.getElementById('grado-select').value;
            let selectContenido = document.getElementById('contenido-select');
            let displayPDA = document.getElementById('pda-display');
            
            selectContenido.disabled = false;
            selectContenido.innerHTML = '<option value="" disabled selected>Elige el Contenido...</option>';
            
            baseDatosArtes.forEach(function(item, index) {
                let nuevaOpcion = document.createElement('option');
                nuevaOpcion.value = index;
                nuevaOpcion.text = item.contenido;
                selectContenido.appendChild(nuevaOpcion);
            });

            displayPDA.innerHTML = "<em>Ahora selecciona el Contenido para ver tu PDA.</em>";
        }

        function mostrarPDA() {
            let gradoElegido = document.getElementById('grado-select').value;
            let indexContenido = document.getElementById('contenido-select').value;
            let displayPDA = document.getElementById('pda-display');

            let pdaExacto = baseDatosArtes[indexContenido].pdas[gradoElegido];
            displayPDA.innerText = pdaExacto;
        }

       // Funci√≥n mejorada para traducir el formato de la IA a HTML limpio
        function formatearTextoIA(texto) {
            let html = texto;
            html = html.replace(/### (.*)/g, '<h4 style="color: var(--primary); margin-top: 20px; border-bottom: 1px solid #eee; padding-bottom: 5px;">$1</h4>');
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/^\* (.*)/gm, '<li style="margin-left: 20px; margin-bottom: 5px;">$1</li>');
            html = html.replace(/```html|```/g, '');
            return html;
        }

        async function generarPlaneacion() {
            let grado = document.getElementById('grado-select').value;
            let indexContenido = document.getElementById('contenido-select').value;
            let problematica = document.getElementById('problematica-input').value;
            let boton = document.querySelector('.btn-submit');
            let cajaResultado = document.getElementById('caja-resultado');
            let textoIA = document.getElementById('texto-ia');

            if(!grado || !indexContenido || problematica.trim() === "") {
                alert("Por favor, completa todos los campos para continuar.");
                return;
            }

            let contenidoFinal = baseDatosArtes[indexContenido].contenido;
            let pdaFinal = baseDatosArtes[indexContenido].pdas[grado];

            // 1. CONSTRUIMOS EL PROMPT M√ÅGICO PARA AVENTURA
            let promptMagico = `Act√∫a exclusivamente como un especialista en pedagog√≠a de Artes interdisciplinarias y en la implementaci√≥n oficial de la Nueva Escuela Mexicana (Plan de Estudios 2022). 

RESTRICCIONES OBLIGATORIAS:
- Basa tu respuesta estrictamente en los principios de la NEM.
- Prohibido utilizar, mencionar o mezclar conceptos del modelo de "Aprendizajes Clave 2017" o enfoques por competencias tradicionales.
- No alteres ni reformules el PDA.
- REGLA DE FORMATO: NO incluyas saludos, introducciones ni despedidas. Genera EXCLUSIVAMENTE el contenido de la planeaci√≥n iniciando directamente con el punto 1.

CONTEXTO DEL DOCENTE:
- Grado: ${grado}¬∞ de Secundaria (Fase 6).
- Contenido del Programa Sint√©tico: ${contenidoFinal}.
- Proceso de Desarrollo de Aprendizaje (PDA): ${pdaFinal}.
- Problem√°tica del contexto escolar/comunitario a atender: ${problematica}.

INSTRUCCIONES:
El docente desea explorar m√∫ltiples lenguajes art√≠sticos sin limitarse a una sola disciplina. Desarrolla una propuesta estructurada con los siguientes t√≠tulos:

1Ô∏è‚É£ AN√ÅLISIS DEL PDA (Taxonom√≠a de Bloom)
Identifica el verbo principal exacto. Clasif√≠calo correctamente y explica el reto cognitivo que representa.

2Ô∏è‚É£ TIEMPO SUGERIDO
Justifica el rango de sesiones considerando el nivel cognitivo de Bloom, la complejidad de integrar m√∫ltiples lenguajes y los procesos reflexivos comunitarios propios de la NEM.

3Ô∏è‚É£ RUTA DE ACTIVIDADES (Enfoque Interdisciplinario)
Dise√±a un Inicio, Desarrollo y Cierre. Integra de manera articulada al menos dos lenguajes art√≠sticos (visuales, teatro, danza, m√∫sica o artes digitales). La mezcla debe ser coherente con el PDA y resolver o problematizar el contexto. Prioriza el proceso sobre el producto y promueve el pensamiento cr√≠tico. No conviertas la planeaci√≥n en un festival art√≠stico sin profundidad pedag√≥gica.

4Ô∏è‚É£ EVALUACI√ìN FORMATIVA
Prop√≥n 2 t√©cnicas y 2 instrumentos enfocados en el proceso creativo, la metacognici√≥n y la construcci√≥n colectiva. Evita r√∫bricas centradas √∫nicamente en la calidad est√©tica final.

VERIFICACI√ìN INTERNA: Confirma silenciosamente que todas las actividades derivan directamente del PDA y que la interdisciplinariedad tiene intenci√≥n pedag√≥gica. NO imprimas esta lista de verificaci√≥n en tu respuesta final. Usa un tono inspirador y profesional.`;

            // 2. CAMBIAMOS EL BOT√ìN PARA QUE EL MAESTRO SEPA QUE EST√Å CARGANDO
            boton.innerText = "‚è≥ Dise√±ando Aventura Interdisciplinaria...";
            boton.disabled = true;
            boton.style.opacity = "0.7";
            cajaResultado.classList.add('hidden'); 

            // 3. LA LLAMADA A LA INTELIGENCIA ARTIFICIAL (API de Gemini)
            const apiKey = 'AIzaSyAGV33FQMo4motATHuzRntNaIMtyvbozmI'; // <--- ¬°RECUERDA PEGAR TU CLAVE REAL AQU√ç!
            const urlAPI = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;

            try {
                const respuesta = await fetch(urlAPI, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: promptMagico }] }]
                    })
                });

                if (!respuesta.ok) throw new Error("Error al conectar con la IA");

                const datos = await respuesta.json();
                
                let respuestaFinal = datos.candidates[0].content.parts[0].text;
                respuestaFinal = formatearTextoIA(respuestaFinal);

                textoIA.innerHTML = respuestaFinal;
                cajaResultado.classList.remove('hidden');

            } catch (error) {
                console.error("Hubo un error:", error);
                alert("Upps, hubo un problema al conectar con la inteligencia artificial. Revisa tu conexi√≥n a internet o tu clave API.");
            } finally {
                // 4. DEVOLVEMOS EL BOT√ìN A LA NORMALIDAD
                boton.innerText = "‚ú® Generar Planeaci√≥n de Aventura ‚ú®";
                boton.disabled = false;
                boton.style.opacity = "1";
            }
        }

            
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('PWA registrada con √©xito.', reg))
        .catch(err => console.log('Error al registrar PWA.', err));
    });
  }
</script>
</body>
</html>